[gd_scene format=3 uid="uid://sinbkwdw48x4"]

[ext_resource type="Resource" uid="uid://cca3p5s5nqb6p" path="res://Resources/Crafting/Repice_RepairPart.tres" id="2_8jde6"]

[sub_resource type="CSharpScript" id="CSharpScript_jjawv"]
script/source = "using Godot;

public partial class CraftingUI : Control
{
    [Export] private RecipeData[] _recipes;
    [Export] private VBoxContainer _recipeList;
    [Export] private PackedScene _buttonPrefab;

    public override void _Ready()
    {
        InventoryManager.Instance.InventoryUpdated += UpdateRecipes;
        UpdateRecipes();
    }

    private void UpdateRecipes()
    {
        if (_recipeList == null) return;
        foreach (Node child in _recipeList.GetChildren()) child.QueueFree();

        if (_recipes == null) return;

        foreach (var recipe in _recipes)
        {
            if (recipe == null) continue;

            var btn = _buttonPrefab.Instantiate<Button>(); 
            _recipeList.AddChild(btn);

            int countA = InventoryManager.Instance.GetItemCount(recipe.IngredientA);
            int countB = InventoryManager.Instance.GetItemCount(recipe.IngredientB);
            bool canCraft = countA >= recipe.AmountA && countB >= recipe.AmountB;

            btn.Text = $\"{recipe.Result?.DisplayName} ({countA}/{recipe.AmountA}, {countB}/{recipe.AmountB})\";
            btn.Disabled = !canCraft;
            
            btn.Pressed += () => InventoryManager.Instance.Craft(recipe);
        }
    }
}"

[sub_resource type="PackedScene" id="PackedScene_kco2j"]
_bundled = {
"conn_count": 0,
"conns": PackedInt32Array(),
"editable_instances": [],
"id_paths": [],
"names": PackedStringArray("CraftingButton", "Button", "offset_right", "offset_bottom", "text"),
"node_count": 1,
"node_ids": PackedInt32Array(1736505492),
"node_paths": [],
"nodes": PackedInt32Array(-1, -1, 1, 0, -1, 3, 2, 0, 3, 1, 4, 2, 0),
"variants": [8.0, 8.0, "test"],
"version": 3
}

[node name="ScrollContainer" type="ScrollContainer" unique_id=684815709 node_paths=PackedStringArray("_recipeList")]
offset_right = 40.0
offset_bottom = 40.0
script = SubResource("CSharpScript_jjawv")
_recipes = Array[Object]([ExtResource("2_8jde6")])
_recipeList = NodePath("VBoxContainer")
_buttonPrefab = SubResource("PackedScene_kco2j")

[node name="VBoxContainer" type="VBoxContainer" parent="." unique_id=759451764]
layout_mode = 2
